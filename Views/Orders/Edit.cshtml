 @* ﻿@model doan1_v1.Models.Order *@

@{
    ViewData["Title"] = "Sửa đơn hàng";
    var order = ViewBag.detailOrder;
    // var totalPriceofProduct = 0.0;
}


<div class="page-inner">
    <div class="page-header">
        <h3 class="fw-bold mb-3">NTMFashion</h3>
        <ul class="breadcrumbs mb-3">
            <li class="nav-home">
                <a href="#">
                    <i class="icon-home"></i>
                </a>
            </li>
            <li class="separator">
                <i class="icon-arrow-right"></i>
            </li>
            <li class="nav-item">
                <a href="#">Quản lý</a>
            </li>
            <li class="separator">
                <i class="icon-arrow-right"></i>
            </li>
            <li class="nav-item">
                <a asp-action="Index">Quản lý đơn hàng</a>
            </li>
        </ul>
    </div>

    <form class="row" asp-action="Edit" method="post">
        <input type="hidden" name="id" value="@order.Id" />
            <div class="mb-3">
                <label for="name" class="form-label">Tên khách hàng</label>
                <input type="text" disabled class="form-control" id="name" value="@order.Customer.FullName">
            </div>

            <div class="mb-3">
                <label for="name" class="form-label">Địa chỉ</label>
            <input type="text" disabled class="form-control" id="name" value="@order.Customer.Address">
            </div>

            <div class="mb-3">
                <label for="name" class="form-label">Số điện thoại</label>
                <input type="text" disabled class="form-control" id="name" value="@order.Customer.PhoneNumber">
            </div>

            <div class="mb-3">
                <label for="datepurchase" class="form-label">Ngày đặt</label>
            <input type="date" disabled class="form-control" id="datepurchase" name="DateOrder" value="@order.DateOrder.ToString("yyyy-MM-dd")">
            <br>
            </div>
            @if(order.DateReceive != null){
                <div class="mb-3">
                    <label for="datepurchase" class="form-label">Ngày giao hàng:</label>
                    <input type="date" class="form-control" id="datepurchase" name="DateReceive" value="@order.DateReceive.ToString("yyyy-MM-dd")">
            </div>
        }
        else
        {
            <div class="mb-3">
                <label for="datepurchase" class="form-label">Ngày dự kiến giao hàng:</label>
                <input type="date" class="form-control" id="datepurchase" name="DateReceive" value="">
            </div>
        }
            
            <!-- bảng hàng hóa -->
            <div class="mb-3">
            <div class="input-group mb-3">
                <input id="productSearch" type="text" class="form-control" placeholder="Nhập tên sản phẩm bạn cần thêm vào đơn hàng" aria-label="Product name" />
                <button id="searchProduct" class="btn btn-primary" type="button">Thêm sản phẩm</button>
            </div>
                <table class="table" id="tableProduct">
                    <thead>
                        <tr>
                            <th>Tên sản phẩm</th>
                            <th>Màu sắc</th>
                            <th>Kích thước</th>
                            <th>Chất liệu</th>
                            <th>Nhà sản xuất</th>
                            <th>Số lượng</th>
                            <th>Giá</th>
                        </tr>
                    </thead>
                    <tbody>

                    @foreach (var detail in order.OrderProductDetails)
                    {
                        <tr>
                            <td><input disabled type="text" class="form-control" value="@detail.Product.Name"></td>
                            <td><input disabled type="text" class="form-control" value="@detail.Product.Color"></td>
                            <td><input disabled type="text" class="form-control" value="@detail.Product.Dimension"></td>
                            <td><input disabled type="text" class="form-control" value="@detail.Product.Material"></td>
                            <td><input disabled type="text" class="form-control" value="@detail.Product.Productor"></td>
                            <td><input name="quantitys" type="number" class="form-control" value="@detail.Quantity"></td>
                            <td><input disabled type="number" class="form-control" value="@detail.Product.Price"></td>


                             <input type="hidden" name="productIds" value="@detail.ProductId"/>
                        </tr>
                    }
                    </tbody>
                </table>

            <div class="mb-3">
                <label for="tongTien">Phí vận chuyển:</label>
                <input type="number" class="form-control" id="tongTien" name="">
            </div>
            <div class="mb-3">
                <label for="tongTien">Phí khác:</label>
                <input type="number" class="form-control" id="tongTien" name="">
            </div>

            <div class="mb-3">
                <label for="tongTien">Tổng tiền:</label>
                <input type="number" class="form-control" id="tongTien" name="" disabled>
            </div>

            <div class="mb-3">
                <label for="office" class="form-label">Ghi chú (nếu có)</label>
                <textarea class="form-control" rows="5" name="note" id=""></textarea>
            </div>
            <div class="mb-3-md">
                <button type="button" class="btn btn-danger" asp-action="Index">Đóng</button>
                <button type="submit" class="btn btn-primary">Cập nhật</button>
            </div>
            </div>
        </form>
</div>
    @* <h1>Edit</h1>

    <h4>Order</h4>
    <hr />
    <div class="row">
    <div class="col-md-4">
    <form asp-action="Edit">
    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
    <input type="hidden" asp-for="Id" />
    <div class="form-group">
    <label asp-for="DateOrder" class="control-label"></label>
    <input asp-for="DateOrder" class="form-control" />
    <span asp-validation-for="DateOrder" class="text-danger"></span>
    </div>
    <div class="form-group">
    <label asp-for="DateReceive" class="control-label"></label>
    <input asp-for="DateReceive" class="form-control" />
    <span asp-validation-for="DateReceive" class="text-danger"></span>
    </div>
    <div class="form-group">
    <label asp-for="DeliveryCost" class="control-label"></label>
    <input asp-for="DeliveryCost" class="form-control" />
    <span asp-validation-for="DeliveryCost" class="text-danger"></span>
    </div>
    <div class="form-group">
    <label asp-for="OtherCost" class="control-label"></label>
    <input asp-for="OtherCost" class="form-control" />
    <span asp-validation-for="OtherCost" class="text-danger"></span>
    </div>
    <div class="form-group">
    <label asp-for="Status" class="control-label"></label>
    <input asp-for="Status" class="form-control" />
    <span asp-validation-for="Status" class="text-danger"></span>
    </div>
    <div class="form-group">
    <label asp-for="Note" class="control-label"></label>
    <input asp-for="Note" class="form-control" />
    <span asp-validation-for="Note" class="text-danger"></span>
    </div>
    <div class="form-group form-check">
    <label class="form-check-label">
    <input class="form-check-input" asp-for="IsDel" /> @Html.DisplayNameFor(model => model.IsDel)
    </label>
    </div>
    <div class="form-group">
    <label asp-for="AdminId" class="control-label"></label>
    <input asp-for="AdminId" class="form-control" />
    <span asp-validation-for="AdminId" class="text-danger"></span>
    </div>
    <div class="form-group">
    <label asp-for="CustomerId" class="control-label"></label>
    <input asp-for="CustomerId" class="form-control" />
    <span asp-validation-for="CustomerId" class="text-danger"></span>
    </div>
    <div class="form-group">
    <input type="submit" value="Save" class="btn btn-primary" />
    </div>
    </form>
    </div>
    </div>

    <div>
    <a asp-action="Index">Back to List</a>
    </div>
    *@
    @section Scripts {
        @{
            await Html.RenderPartialAsync("_ValidationScriptsPartial");
        }
    <!-- nguyen's script -->
@*     find product *@
<script>
    document.getElementById("searchProduct").addEventListener("click", function () {
        var productName = document.getElementById("productSearch").value.trim();

        if (!productName) {
            alert("Chưa nhập tên sản phẩm kìa.");
            return;
        }

        fetch(`/Orders/GetProduct?name=${encodeURIComponent(productName)}`)
            .then((response) => {
                if (!response.ok) {
                    throw new Error("Không tìm thấy sản phẩm");
                }
                return response.json();
            })
            .then((data) => {
                // Add product details to the table
                var table = document.getElementById("tableProduct");
                var tbody = table.getElementsByTagName("tbody")[0];

                // Create a new row
                var newRow = tbody.insertRow();

                // Add cells and populate with data
                var cell1 = newRow.insertCell(0);
                var cell3 = newRow.insertCell(1);
                var cell4 = newRow.insertCell(2);
                var cell5 = newRow.insertCell(3);
                var cell6 = newRow.insertCell(4);
                var cell7 = newRow.insertCell(5);
                var cell8 = newRow.insertCell(6);

                // Fill in data
                cell1.innerHTML = `
    <input disabled type="text" class="form-control" value="${data.name}">`;

                // Add other input fields
                cell3.innerHTML = `
    <input disabled type="text" class="form-control" value="${data.color || ''}">`;
                cell4.innerHTML = `
    <input disabled type="text" class="form-control" value="${data.dimension || ''}">`;
                cell5.innerHTML = `
    <input disabled type="text" class="form-control" value="${data.material || ''}">`;
                cell6.innerHTML = `
    <input disabled type="text" class="form-control" value="${data.productor || ''}">`;
                cell7.innerHTML = `
    <input name="quantitys" type="number" class="form-control" value="${data.quantity || 1}">`;
                cell8.innerHTML = `
    <input disabled type="number" class="form-control" value="${data.price || 0}">`;
                             // Add a hidden input field inside the <tr>
           

            var hiddenInput = document.createElement("input");
            hiddenInput.type = "hidden";
            hiddenInput.name = "productIds";
            hiddenInput.value = data.id;
            newRow.appendChild(hiddenInput);
            })

            .catch((error) => {
                console.error(error);
                alert("Unable to fetch product details.");
            });
    });
    </script>
    }